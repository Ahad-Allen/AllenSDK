<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>API Access &mdash; Allen SDK 0.10.1 documentation</title>
    
    <link rel="stylesheet" href="_static/aibs_sphinx.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.10.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Allen SDK 0.10.1 documentation" href="index.html" />
    <link rel="up" title="Data Resources" href="data_resources.html" />
    <link rel="next" title="Models" href="models.html" />
    <link rel="prev" title="Mouse Connectivity" href="connectivity.html" /> 
  </head>
  <body>
<script type="text/javascript" src="/AllenSDK/_static/external_assets/javascript/portal.js"></script>
<style>

	/* the icon font-family definition and helper classes */
	@font-face {
	  font-family: 'portal_icon_font';
	  src: url('/AllenSDK/_static/external_assets/stylesheets/portal_icon_font.eot?39505677');
	  src: url('/AllenSDK/_static/external_assets/stylesheets/portal_icon_font.eot?39505677#iefix') format('embedded-opentype'),
	       url('/AllenSDK/_static/external_assets/stylesheets/portal_icon_font.woff?39505677') format('woff'),
	       url('/AllenSDK/_static/external_assets/stylesheets/portal_icon_font.ttf?39505677') format('truetype'),
	       url('/AllenSDK/_static/external_assets/stylesheets/portal_icon_font.svg?39505677#portal_icon_font') format('svg');
	  font-weight: normal;
	  font-style: normal;
	}
	 
	 [class^="icon-"]:before, [class*=" icon-"]:before {
	  font-family: "portal_icon_font";
	  font-style: normal;
	  font-weight: normal;
	  speak: none;
	 
	  display: inline-block;
	  text-decoration: inherit;
	  width: 1em;
	  margin-right: .2em;
	  text-align: center;
	  /* opacity: .8; */
	 
	  /* For safety - reset parent styles, that can break glyph codes*/
	  font-variant: normal;
	  text-transform: none;
	     
	  /* fix buttons height, for twitter bootstrap */
	  line-height: 1em;
	 
	  /* Animation center compensation - margins should be symmetric */
	  /* remove if not needed */
	  margin-left: .2em;
	
	}
	 
	.icon-spin5:before { content: '\e806'; } /* '' */
	.icon-left-open-1:before { content: '\e81e'; } /* '' */
	.icon-plus-1:before { content: '\e801'; } /* '' */
	.icon-facebook:before { content: '\e816'; } /* '' */
	.icon-gplus:before { content: '\e818'; } /* '' */
	.icon-linkedin-3:before { content: '\e815'; } /* '' */
	.icon-twitter:before { content: '\e817'; } /* '' */
	.icon-youtube-play:before { content: '\e805'; } /* '' */
	.icon-plus-2:before { content: '\e809'; } /* '' */
	.icon-record-1:before { content: '\e81c'; } /* '' */
	.icon-cancel:before { content: '\e80b'; } /* '' */
	.icon-search:before { content: '\e804'; } /* '' */
	.icon-cancel-2:before { content: '\e80c'; } /* '' */
	.icon-plus-4:before { content: '\e80d'; } /* '' */
	.icon-cancel-3:before { content: '\e80e'; } /* '' */
	.icon-plus:before { content: '\e808'; } /* '' */
	.icon-down-open:before { content: '\e800'; } /* '' */
	.icon-right-open:before { content: '\e802'; } /* '' */
	.icon-up-open:before { content: '\e803'; } /* '' */
	.icon-stop:before { content: '\e813'; } /* '' */
	.icon-cancel-1:before { content: '\e820'; } /* '' */
	.icon-plus-3:before { content: '\e80a'; } /* '' */
	/* end icon font helpers */

	/* icon font spin animation */
	.animate-spin {
	  -moz-animation: spin 2s infinite linear;
	  -o-animation: spin 2s infinite linear;
	  -webkit-animation: spin 2s infinite linear;
	  animation: spin 2s infinite linear;
	  display: inline-block;
	}
	@-moz-keyframes spin {
	  0% {
	    -moz-transform: rotate(0deg);
	    -o-transform: rotate(0deg);
	    -webkit-transform: rotate(0deg);
	    transform: rotate(0deg);
	  }

	  100% {
	    -moz-transform: rotate(359deg);
	    -o-transform: rotate(359deg);
	    -webkit-transform: rotate(359deg);
	    transform: rotate(359deg);
	  }
	}
	@-webkit-keyframes spin {
	  0% {
	    -moz-transform: rotate(0deg);
	    -o-transform: rotate(0deg);
	    -webkit-transform: rotate(0deg);
	    transform: rotate(0deg);
	  }

	  100% {
	    -moz-transform: rotate(359deg);
	    -o-transform: rotate(359deg);
	    -webkit-transform: rotate(359deg);
	    transform: rotate(359deg);
	  }
	}
	@-o-keyframes spin {
	  0% {
	    -moz-transform: rotate(0deg);
	    -o-transform: rotate(0deg);
	    -webkit-transform: rotate(0deg);
	    transform: rotate(0deg);
	  }

	  100% {
	    -moz-transform: rotate(359deg);
	    -o-transform: rotate(359deg);
	    -webkit-transform: rotate(359deg);
	    transform: rotate(359deg);
	  }
	}
	@-ms-keyframes spin {
	  0% {
	    -moz-transform: rotate(0deg);
	    -o-transform: rotate(0deg);
	    -webkit-transform: rotate(0deg);
	    transform: rotate(0deg);
	  }

	  100% {
	    -moz-transform: rotate(359deg);
	    -o-transform: rotate(359deg);
	    -webkit-transform: rotate(359deg);
	    transform: rotate(359deg);
	  }
	}
	@keyframes spin {
	  0% {
	    -moz-transform: rotate(0deg);
	    -o-transform: rotate(0deg);
	    -webkit-transform: rotate(0deg);
	    transform: rotate(0deg);
	  }

	  100% {
	    -moz-transform: rotate(359deg);
	    -o-transform: rotate(359deg);
	    -webkit-transform: rotate(359deg);
	    transform: rotate(359deg);
	  }
	}
	/*  end spin animation */	

	@font-face {
	    font-family: 'bebas_neueregular';
	    src: url('/AllenSDK/_static/external_assets/stylesheets/bebasneue-webfont.eot');
	    src: url('/AllenSDK/_static/external_assets/stylesheets/bebasneue-webfont.eot?#iefix') format('embedded-opentype'),
	         url('/AllenSDK/_static/external_assets/stylesheets/bebasneue-webfont.woff') format('woff'),
	         url('/AllenSDK/_static/external_assets/stylesheets/bebasneue-webfont.ttf') format('truetype'),
	         url('/AllenSDK/_static/external_assets/stylesheets/bebasneue-webfont.svg#bebas_neueregular') format('svg');
	    font-weight: normal;
	    font-style: normal;
	}

	/* top chrome styles */
	#top_chrome {

		width:100%;
		height:28px;
		background-color:#163E65;
	}

	.chrome_link_block {

		color:#fff !important;	
		display:inline-block;
		height:100%;
		max-height:28px;
	}

	.chrome_link_block:hover {

		background-color:#eee;
		color:#0779BE !important;	
		cursor:pointer;
	}

	#top_chrome a {

		color:inherit !important;	
		text-decoration:none;
	}

	#top_chrome a:hover {

		color:inherit !important;	
	}

	#top_chrome_buttons {

		float:right;
		margin-right:50px;
	}

	.chrome_button {

		font-family:arial,sans-serif;
		font-weight:bold;
		display:inline-block;
		font-size:9px;
		text-align:left;
		text-decoration:none;
		margin:9px 20px 10px 20px;
	}

	.chrome_active {

		background-color:#1b7abd;
		color:#fff;
	}


	/* header element styles*/
	#header_content {

		font-family: bebas_neueregular, arial, sans-serif;
		font-size:22px;
		color:#0779be;		
		letter-spacing:0.03em;

		position:relative;
		width:calc(100% - 112px);
		min-width:800px;
		height:76px;
		border-bottom:2px solid #A5A8AB;
		margin-left:50px;
		margin-right:50px;
        z-index:9999; /* IT-9508 */
	}

	#portal_logo {

		position:absolute;
		top:20px;
		left:0px;
		width:236px;
	}

	#portal_tabs {

		position: absolute;
		bottom: 12px;
		left: 0px;
		margin-bottom: -12px;
		display: block;
	}

	.horizontal_list
	{
		margin: 0;
		padding: 0;
		list-style-type: none;
		display: inline; 		
	}

	.horizontal_list li { 

		display: inline; 	
	}	

	#portal_tab_menu_container {

		display:none;
	}

	#portal_search_input_group {

		position:absolute;
		margin: 0;
		padding: 0;
		bottom:12px;
		right:0px;
		border:1px solid #DAD9D3;
		color:#DAD9D3;
	}

	#portal_search_input_group input {

		margin: 0;
		padding: 0;
		border:none;
		width:110px;
		color:#DAD9D3;
		font-family:Helvetica,sans-serif;
		font-size:12px;
		height:28px;
		margin-left:10px;

		outline:none;
	}

	input::-ms-clear {
		display: none;
	}

	#portal_search_input_group i {

		font-size:0.8em;
		cursor:pointer;
	}

	#pSiteSearchTextInput:focus {

		color:#000;
	}

	.icon_menu_down {

		font-size: 12px;
		margin-left: 4px;
		vertical-align: text-top;
		padding-top: 4px;
		display: inline-block;
	}

	.portal_tab_item {

		background-color: #fff;
		padding: 12px;
		padding-left:20px;
		padding-right:20px;
		display: inline-block !important;		
	}

	.portal_tab_item a:hover {

		color:#fbe300;	
	}

	.portal_tab_item:hover {

		background-color: #0779be;	
		color:#fbe300 !important;	
	}	


	.portal_menu_active {

		background-color: #EEEEEE;
	}	

	.portal_menu_item_active {

		color:#fbe300 !important;	
	}

	.portal_tab_active {

		color:#a5a8ab !important;
	}

	#header_content a {		

		color:inherit !important;
	}

	#header_content a:hover {

		background-color: #0779be;	
		color:#fbe300 !important;	
	}

	#header_content ul {

		list-style: none;
		position: relative;
		top: 58px;
		display: inline-table;
	}

	#header_content ul ul {
		
		display:none;
		opacity:0;
	}

	/* the fly out menus */
	#header_content ul li:hover > ul,
	#header_content ul li.hover > ul {

		position: absolute;
		top: 48px;
		z-index:999;

		display: block;
		width: 152px;
		padding:0px;
		padding-top:20px;
		padding-bottom:10px;
		font-size: 12px;
		font-family: Arial,Sans-Serif;
		font-weight: bold;
		text-transform: uppercase;

		background-color: rgba(8,122,191,0.98);
		color: #fff !important;
		opacity: 1;

		-webkit-animation: fade 0.25s;
		animation: fade 0.25s;
	}

	@-webkit-keyframes fade {
	    from {opacity: 0}
	    to {opacity: 1}
	}
	@keyframes fade {
	    from {opacity: 0}
	    to {opacity: 1}
	}	

	#header_content ul li:hover > ul li {

		padding: 10px;
		padding-top: 0px;
		padding-left: 20px;
		display: block;
		opacity:1;
	}

	#header_content ul li:hover > ul a {

		display: block;
		opacity:1;
		white-space:nowrap;
	}

	#portal_menu_start_list {

		left: 81px;

		/* IE sauce */
		left:85px\9;

		/* Safari sauce */
		(;left:79px;);
	}

	#portal_menu_atlases_list {

		left: 290px;
		width: 210px !important;
        height: 236px;

		padding-bottom:5px !important;

		/* IE sauce */
		left: 303px\9;
        height: 225px\9;

		/* Safari sauce */
		(;left:279px;);
	}

	#portal_menu_tools_list {

		left: 500px;
		width: 172px !important;
		height: 236px;

		padding-bottom:5px !important;

		/* IE sauce */
		left: 513px\9;
		height:225px\9;

		/* Safari sauce */
		(;left:489px;);
		(;height:227px;);
	}

	/* mozilla sauce */
	@-moz-document url-prefix() {

		#header_content {

			height:107px;
		}

		#portal_menu_start_list {

			left:85px;
		}

		#portal_menu_atlases_list {

			left: 302px;		
		}

		#portal_menu_tools_list {

			left: 512px;
			height:236px;
		}
	}


	/* make it look OK on iPad also */
	@media all and (device-width: 768px) and (device-height: 1024px) and (orientation:portrait) {

		#portal_menu_start_list {

			left:81px;
		}

		#portal_menu_atlases_list {

			left: 291px;		
		}

		#portal_menu_tools_list {

			left: 501px;
			height:236px;
		}  
	}
	@media all and (device-width: 768px) and (device-height: 1024px) and (orientation:landscape) {

		#portal_menu_start_list {

			left:81px;
		}

		#portal_menu_atlases_list {

			left: 291px;		
		}

		#portal_menu_tools_list {

			left: 501px;
			height:236px;
		}	  
	}

	.portal_menu_list_heading {

		color:#9ccae5;
		border-bottom:1px solid #9ccae5;
		padding-bottom:5px !important;
	}

	.portal_menu_list_heading + li {

		padding-top:10px !important;
	}

	.portal_menu_list_heading li {

		padding-bottom:0px;
	}	

	#portal_menu_atlases_list li:last-of-type {

		padding-bottom:15px !important;
	}

	.icon-spin5 {

		color:#000;
	}
</style>
<div id="pHeader">
<div id="top_chrome">
	<div id="top_chrome_buttons">
		<div class="chrome_link_block"><a href="http://www.alleninstitute.org" target="_blank" class="chrome_button">ALLEN INSTITUTE</a></div>
		<div class="chrome_link_block chrome_active"><a href="http://www.brain-map.org" class="chrome_button">BRAIN ATLAS</a></div>
	</div>
</div>

<div id="header_content">

	<a href="http://AllenInstitute.github.io/AllenSDK">
		<img id="portal_logo" style="border:0;" src="/AllenSDK/_static/external_assets/images/Brain_Atlas_Logotype_SDK.png"/>
	</a>
</div>
</div>

<script>

jQuery('#portal_tab_menu').bind('touchstart', function() {

	if(window.console)
		console.log("touchstart");
});
</script>
<link rel="stylesheet" type="text/css" href="/AllenSDK/_static/external_assets/stylesheets/common_layout.css" />


  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="api-access">
<h1>API Access<a class="headerlink" href="#api-access" title="Permalink to this headline">¶</a></h1>
<p>The <a class="reference internal" href="allensdk.api.html#module-allensdk.api" title="allensdk.api"><tt class="xref py py-mod docutils literal"><span class="pre">allensdk.api</span></tt></a> package is designed to help retrieve data from the
<a class="reference external" href="http://help.brain-map.org/display/api/Allen+Brain+Atlas+API">Allen Brain Atlas API</a>. <a class="reference internal" href="allensdk.api.html#module-allensdk.api" title="allensdk.api"><tt class="xref py py-mod docutils literal"><span class="pre">api</span></tt></a>
contains methods to help formulate API queries and parse the returned results.  There are several
pre-made subclasses available that provide pre-made queries specific to certain data sets. Currently there
are several subclasses in Allen SDK:</p>
<blockquote>
<div><ul class="simple">
<li><a class="reference internal" href="allensdk.api.queries.html#allensdk.api.queries.cell_types_api.CellTypesApi" title="allensdk.api.queries.cell_types_api.CellTypesApi"><tt class="xref py py-class docutils literal"><span class="pre">CellTypesApi</span></tt></a>: data related to the Allen Cell Types Database</li>
<li><a class="reference internal" href="allensdk.api.queries.html#allensdk.api.queries.biophysical_perisomatic_api.BiophysicalPerisomaticApi" title="allensdk.api.queries.biophysical_perisomatic_api.BiophysicalPerisomaticApi"><tt class="xref py py-class docutils literal"><span class="pre">BiophysicalPerisomaticApi</span></tt></a>: data related to perisomatic biophysical models</li>
<li><a class="reference internal" href="allensdk.api.queries.html#allensdk.api.queries.glif_api.GlifApi" title="allensdk.api.queries.glif_api.GlifApi"><tt class="xref py py-class docutils literal"><span class="pre">GlifApi</span></tt></a>: data related to GLIF models</li>
<li><a class="reference internal" href="allensdk.api.queries.html#allensdk.api.queries.annotated_section_data_sets_api.AnnotatedSectionDataSetsApi" title="allensdk.api.queries.annotated_section_data_sets_api.AnnotatedSectionDataSetsApi"><tt class="xref py py-class docutils literal"><span class="pre">AnnotatedSectionDataSetsApi</span></tt></a>: search for experiments by intensity, density, pattern, and age</li>
<li><a class="reference internal" href="allensdk.api.queries.html#allensdk.api.queries.grid_data_api.GridDataApi" title="allensdk.api.queries.grid_data_api.GridDataApi"><tt class="xref py py-class docutils literal"><span class="pre">GridDataApi</span></tt></a>: used to download 3-D expression grid data</li>
<li><a class="reference internal" href="allensdk.api.queries.html#allensdk.api.queries.image_download_api.ImageDownloadApi" title="allensdk.api.queries.image_download_api.ImageDownloadApi"><tt class="xref py py-class docutils literal"><span class="pre">ImageDownloadApi</span></tt></a>: download whole or partial two-dimensional images</li>
<li><a class="reference internal" href="allensdk.api.queries.html#allensdk.api.queries.mouse_connectivity_api.MouseConnectivityApi" title="allensdk.api.queries.mouse_connectivity_api.MouseConnectivityApi"><tt class="xref py py-class docutils literal"><span class="pre">MouseConnectivityApi</span></tt></a>: common operations for accessing the Allen Mouse Brain Connectivity Atlas</li>
<li><a class="reference internal" href="allensdk.api.queries.html#allensdk.api.queries.ontologies_api.OntologiesApi" title="allensdk.api.queries.ontologies_api.OntologiesApi"><tt class="xref py py-class docutils literal"><span class="pre">OntologiesApi</span></tt></a>: data about neuroanatomical regions of interest</li>
<li><a class="reference internal" href="allensdk.api.queries.html#allensdk.api.queries.connected_services.ConnectedServices" title="allensdk.api.queries.connected_services.ConnectedServices"><tt class="xref py py-class docutils literal"><span class="pre">ConnectedServices</span></tt></a>: schema of Allen Institute Informatics Pipeline services available through the RmaApi</li>
<li><a class="reference internal" href="allensdk.api.queries.html#allensdk.api.queries.rma_api.RmaApi" title="allensdk.api.queries.rma_api.RmaApi"><tt class="xref py py-class docutils literal"><span class="pre">RmaApi</span></tt></a>: general-purpose HTTP interface to the Allen Institute API data model and services</li>
<li><a class="reference internal" href="allensdk.api.queries.html#allensdk.api.queries.svg_api.SvgApi" title="allensdk.api.queries.svg_api.SvgApi"><tt class="xref py py-class docutils literal"><span class="pre">SvgApi</span></tt></a>:  annotations associated with images as scalable vector graphics (SVG)</li>
<li><a class="reference internal" href="allensdk.api.queries.html#allensdk.api.queries.synchronization_api.SynchronizationApi" title="allensdk.api.queries.synchronization_api.SynchronizationApi"><tt class="xref py py-class docutils literal"><span class="pre">SynchronizationApi</span></tt></a>: data about image alignment</li>
<li><a class="reference internal" href="allensdk.api.queries.html#allensdk.api.queries.tree_search_api.TreeSearchApi" title="allensdk.api.queries.tree_search_api.TreeSearchApi"><tt class="xref py py-class docutils literal"><span class="pre">TreeSearchApi</span></tt></a>: list ancestors or descendents of structure and specimen trees</li>
</ul>
</div></blockquote>
<div class="section" id="rma-database-and-service-api">
<h2>RMA Database and Service API<a class="headerlink" href="#rma-database-and-service-api" title="Permalink to this headline">¶</a></h2>
<p>One API subclass is the <a class="reference internal" href="allensdk.api.queries.html#allensdk.api.queries.rma_api.RmaApi" title="allensdk.api.queries.rma_api.RmaApi"><tt class="xref py py-class docutils literal"><span class="pre">RmaApi</span></tt></a> class.
It is intended to simplify
<a class="reference external" href="http://help.brain-map.org/display/api/RESTful+Model+Access+%28RMA%29">constructing an RMA query</a>.</p>
<p>The RmaApi is a base class for much of the allensdk.api.queries
package, but it may be used directly to customize queries or to
build queries from scratch.</p>
<p>Often a query will simply request a table of data of one type:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">allensdk.api.queries.rma_api</span> <span class="kn">import</span> <span class="n">RmaApi</span>

<span class="n">rma</span> <span class="o">=</span> <span class="n">RmaApi</span><span class="p">()</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">rma</span><span class="o">.</span><span class="n">model_query</span><span class="p">(</span><span class="s">&#39;Atlas&#39;</span><span class="p">,</span>
                       <span class="n">criteria</span><span class="o">=</span><span class="s">&quot;[name$il&#39;*Mouse*&#39;]&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>This will construct the RMA query url, make the query and parse the resulting JSON
into an array of Python dicts with the names, ids and other information about the atlases
that can be accessed via the API.</p>
<p>Using the criteria, include and other parameter, specific data can be requested.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">associations</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s">&#39;[id$eq1]&#39;</span><span class="p">,</span>
                        <span class="s">&#39;structure_graph(ontology),&#39;</span><span class="p">,</span>
                        <span class="s">&#39;graphic_group_labels&#39;</span><span class="p">])</span>

<span class="n">atlas_data</span> <span class="o">=</span> <span class="n">rma</span><span class="o">.</span><span class="n">model_query</span><span class="p">(</span><span class="s">&#39;Atlas&#39;</span><span class="p">,</span>
                             <span class="n">include</span><span class="o">=</span><span class="n">associations</span><span class="p">,</span>
                             <span class="n">criteria</span><span class="o">=</span><span class="n">associations</span><span class="p">,</span>
                             <span class="n">only</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;atlases.id&#39;</span><span class="p">,</span>
                                   <span class="s">&#39;atlases.name&#39;</span><span class="p">,</span>
                                   <span class="s">&#39;atlases.image_type&#39;</span><span class="p">,</span>
                                   <span class="s">&#39;ontologies.id&#39;</span><span class="p">,</span>
                                   <span class="s">&#39;ontologies.name&#39;</span><span class="p">,</span>
                                   <span class="s">&#39;structure_graphs.id&#39;</span><span class="p">,</span>
                                   <span class="s">&#39;structure_graphs.name&#39;</span><span class="p">,</span>
                                   <span class="s">&#39;graphic_group_labels.id&#39;</span><span class="p">,</span>
                                   <span class="s">&#39;graphic_group_labels.name&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>Note that a &#8216;class&#8217; name is used for the first parameter.
&#8216;Association&#8217; names are used to construct the include and criteria
parameters nested using parentheses and commas.
In the only clause, the &#8216;table&#8217; form is used,
which is generally a plural lower-case version of the class name.
The only clause selects specific &#8216;fields&#8217; to be returned.
The schema that includes the classes, fields, associations and tables
can be accessed in JSON form using:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># http://api.brain-map.org/api/v2/data.json</span>
<span class="n">schema</span> <span class="o">=</span> <span class="n">rma</span><span class="o">.</span><span class="n">get_schema</span><span class="p">()</span>
<span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">schema</span><span class="p">:</span>
    <span class="n">data_description</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="s">&#39;DataDescription&#39;</span><span class="p">]</span>
    <span class="n">clz</span> <span class="o">=</span> <span class="n">data_description</span><span class="o">.</span><span class="n">keys</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">info</span> <span class="o">=</span> <span class="n">data_description</span><span class="o">.</span><span class="n">values</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">fields</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="s">&#39;fields&#39;</span><span class="p">]</span>
    <span class="n">associations</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="s">&#39;associations&#39;</span><span class="p">]</span>
    <span class="n">table</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="s">&#39;table&#39;</span><span class="p">]</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;class: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">clz</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;fields: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">)))</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;associations: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">associations</span><span class="p">)))</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;table: </span><span class="si">%s</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">table</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="using-pandas-to-process-query-results">
<h2>Using Pandas to Process Query Results<a class="headerlink" href="#using-pandas-to-process-query-results" title="Permalink to this headline">¶</a></h2>
<p>When it is difficult to get data in exactly the required form
using only an RMA query, it may be helpful to perform additional
operations on the client side.  The pandas library can be useful
for this.</p>
<p>Data from the API can be read directly into a pandas
<a class="reference external" href="http://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.html">Dataframe</a> object.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>

<span class="n">structures</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">rma</span><span class="o">.</span><span class="n">model_query</span><span class="p">(</span><span class="s">&#39;Structure&#39;</span><span class="p">,</span>
                    <span class="n">criteria</span><span class="o">=</span><span class="s">&#39;[graph_id$eq1]&#39;</span><span class="p">,</span>
                    <span class="n">num_rows</span><span class="o">=</span><span class="s">&#39;all&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p><a class="reference external" href="http://pandas.pydata.org/pandas-docs/stable/indexing.html">Indexing</a>
subsets of the data (certain columns, certain rows) is one use of pandas:
specifically <a class="reference external" href="http://pandas.pydata.org/pandas-docs/stable/indexing.html#selection-by-label">.loc</a>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">names_and_acromyms</span> <span class="o">=</span> <span class="n">structures</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,[</span><span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="s">&#39;acronym&#39;</span><span class="p">]]</span>
</pre></div>
</div>
<p>and <a class="reference external" href="http://pandas.pydata.org/pandas-docs/stable/indexing.html#boolean-indexing">Boolean indexing</a></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">mea</span> <span class="o">=</span> <span class="n">structures</span><span class="p">[</span><span class="n">structures</span><span class="o">.</span><span class="n">acronym</span> <span class="o">==</span> <span class="s">&#39;MEA&#39;</span><span class="p">]</span>
<span class="n">mea_id</span> <span class="o">=</span> <span class="n">mea</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span><span class="o">.</span><span class="n">id</span>
<span class="n">mea_children</span> <span class="o">=</span> <span class="n">structures</span><span class="p">[</span><span class="n">structures</span><span class="o">.</span><span class="n">parent_structure_id</span> <span class="o">==</span> <span class="n">mea_id</span><span class="p">]</span>
<span class="k">print</span><span class="p">(</span><span class="n">mea_children</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p><a class="reference external" href="http://pandas.pydata.org/pandas-docs/stable/merging.html">Concatenate, merge and join</a>
are used to add columns or rows:</p>
<p>When an RMA call contains an include clause, the associated data will be represented
as a python dict in a single column.  The column may be converted
to a proper Dataframe and optionally dropped.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">criteria_string</span> <span class="o">=</span> <span class="s">&quot;structure_sets[name$eq&#39;Mouse Connectivity - Summary&#39;]&quot;</span>
<span class="n">include_string</span> <span class="o">=</span> <span class="s">&quot;ontology&quot;</span>
<span class="n">summary_structures</span> <span class="o">=</span> \
    <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
        <span class="n">rma</span><span class="o">.</span><span class="n">model_query</span><span class="p">(</span><span class="s">&#39;Structure&#39;</span><span class="p">,</span>
                        <span class="n">criteria</span><span class="o">=</span><span class="n">criteria_string</span><span class="p">,</span>
                        <span class="n">include</span><span class="o">=</span><span class="n">include_string</span><span class="p">,</span>
                        <span class="n">num_rows</span><span class="o">=</span><span class="s">&#39;all&#39;</span><span class="p">))</span>
<span class="n">ontologies</span> <span class="o">=</span> \
    <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
        <span class="nb">list</span><span class="p">(</span><span class="n">summary_structures</span><span class="o">.</span><span class="n">ontology</span><span class="p">))</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
<span class="n">flat_structures_dataframe</span> <span class="o">=</span> <span class="n">summary_structures</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s">&#39;ontology&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>Alternatively, it can be accessed using normal python dict and list operations.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">print</span><span class="p">(</span><span class="n">summary_structures</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s">&#39;ontology&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</pre></div>
</div>
<p>Pandas Dataframes can be written to a CSV file using to_csv and read using load_csv.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">summary_structures</span><span class="p">[[</span><span class="s">&#39;id&#39;</span><span class="p">,</span>
                    <span class="s">&#39;parent_structure_id&#39;</span><span class="p">,</span>
                    <span class="s">&#39;acronym&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s">&#39;summary_structures.csv&#39;</span><span class="p">,</span>
                                       <span class="n">index_label</span><span class="o">=</span><span class="s">&#39;structure_id&#39;</span><span class="p">)</span>
<span class="n">reread</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_csv</span><span class="p">(</span><span class="s">&#39;summary_structures.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Iteration over a Dataframe of API data can be done in several ways.
The .itertuples method is one way to do it.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">for</span> <span class="nb">id</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">parent_structure_id</span> <span class="ow">in</span> <span class="n">summary_structures</span><span class="p">[[</span><span class="s">&#39;name&#39;</span><span class="p">,</span>
                                                         <span class="s">&#39;parent_structure_id&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">itertuples</span><span class="p">():</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%d</span><span class="s"> </span><span class="si">%s</span><span class="s"> </span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">parent_structure_id</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="caching-queries-on-disk">
<h2>Caching Queries on Disk<a class="headerlink" href="#caching-queries-on-disk" title="Permalink to this headline">¶</a></h2>
<p><a class="reference internal" href="allensdk.api.html#allensdk.api.cache.Cache.wrap" title="allensdk.api.cache.Cache.wrap"><tt class="xref py py-meth docutils literal"><span class="pre">wrap()</span></tt></a> has several parameters for querying the API,
saving the results as CSV or JSON and reading the results as a pandas dataframe.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">allensdk.api.cache</span> <span class="kn">import</span> <span class="n">Cache</span>

<span class="n">cache_writer</span> <span class="o">=</span> <span class="n">Cache</span><span class="p">()</span>
<span class="n">do_cache</span><span class="o">=</span><span class="bp">True</span>
<span class="n">structures_from_api</span> <span class="o">=</span> \
    <span class="n">cache_writer</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span><span class="n">rma</span><span class="o">.</span><span class="n">model_query</span><span class="p">,</span>
                      <span class="n">path</span><span class="o">=</span><span class="s">&#39;summary.csv&#39;</span><span class="p">,</span>
                      <span class="n">cache</span><span class="o">=</span><span class="n">do_cache</span><span class="p">,</span>
                      <span class="n">model</span><span class="o">=</span><span class="s">&#39;Structure&#39;</span><span class="p">,</span>
                      <span class="n">criteria</span><span class="o">=</span><span class="s">&#39;[graph_id$eq1]&#39;</span><span class="p">,</span>
                      <span class="n">num_rows</span><span class="o">=</span><span class="s">&#39;all&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>If you change to_cache to False and run the code again it will read the data
from disk rather than executing the query.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<h3><a href="index.html">Contents</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="install.html">Install Guide</a><ul class="simple">
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="data_resources.html">Data Resources</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="cell_types.html">Cell Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="connectivity.html">Mouse Connectivity</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">API Access</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="models.html">Models</a><ul>
<li class="toctree-l2"><a class="reference internal" href="glif_models.html">Generalized LIF</a></li>
<li class="toctree-l2"><a class="reference internal" href="biophysical_perisomatic_script.html">Perisomatic Biophysical</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="allensdk.html">Source Documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="allensdk.api.html">allensdk.api package</a></li>
<li class="toctree-l2"><a class="reference internal" href="allensdk.config.html">allensdk.config package</a></li>
<li class="toctree-l2"><a class="reference internal" href="allensdk.core.html">allensdk.core package</a></li>
<li class="toctree-l2"><a class="reference internal" href="allensdk.ephys.html">allensdk.ephys package</a></li>
<li class="toctree-l2"><a class="reference internal" href="allensdk.model.html">allensdk.model package</a></li>
<li class="toctree-l2"><a class="reference internal" href="allensdk.test.html">allensdk.test package</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/AllenInstitute/AllenSDK">Github Profile</a></li>
</ul>


<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>


    <div class="footer">
    </div>
<script type="text/javascript" src="/AllenSDK/_static/external_assets/javascript/portalFooter.js"></script>

  </body>
</html>