<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Generalized LIF Models &mdash; Allen SDK 0.12.5 documentation</title>
    
    <link rel="stylesheet" href="_static/aibs_sphinx.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.12.5',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Allen SDK 0.12.5 documentation" href="index.html" />
    <link rel="up" title="Models" href="models.html" />
    <link rel="next" title="Biophysical Models" href="biophysical_models.html" />
    <link rel="prev" title="Models" href="models.html" /> 
  </head>
  <body role="document">
<link href="http://www.brain-map.org/assets/stylesheets/portal.css" media="screen" rel="stylesheet" type="text/css" />
<script src="http://www.brain-map.org/assets/javascripts/portal.js" type="text/javascript"></script>
<script type="text/javascript">
    var _pSupressBrowserFlashWarning = true;
    var _pTabId = "pHome";
    var _pMoreProjectsId = "pMoreProjects";
    var _pImagePath = "http://www.brain-map.org/assets/images/";
</script>
<script type="text/javascript">
    function initialize() {
        /*** do your stuff, then initialize the portal plugin ***/
        _pPortalOnLoad();
    }
</script>
<style>
  div.document {
  position:relative !important;;
  }

  img#portal_logo{
  display:none;
  }
  
  #header_content{
  height:75px !important;
  }

  #header_content > a {
  display: inline-block;
  width: 250px;
  height: 75px;
  background-image:url("/_static/external_assets/images/Brain_Atlas_Logotype_SDK.png") !important;
  background-size: 235px 37px;
  background-position: 0px 20px;
  background-repeat: no-repeat;
  }

  #header_content > a:hover {
  background-color: transparent;
  }

  #portal_tabs {
  display:none !important;;
  }

  #portal_search_input_group {
  display:none !important;
  }
</style>

<script type="text/javascript" src="http://www.brain-map.org/external_assets/javascripts/portalHeader.js"></script>
<link rel="stylesheet" type="text/css" href="/_static/external_assets/stylesheets/common_layout.css" />


  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="generalized-lif-models">
<h1>Generalized LIF Models<a class="headerlink" href="#generalized-lif-models" title="Permalink to this headline">¶</a></h1>
<p>The Allen Cell Types Database contains Generalized Leaky Integrate and Fire
(GLIF) models that simulate the firing behavior of neurons at five levels of complexity.
Review the GLIF technical <a class="reference external" href="http://help.brain-map.org/display/celltypes/Documentation">white paper</a>
for details on these models and how their parameters were optimized.</p>
<p>The Allen SDK GLIF simulation module is an explicit time-stepping simulator
that evolves a neuron&#8217;s simulated voltage over the course of an input
current stimulus.  The module also tracks the neuron&#8217;s simulated spike
threshold and registers action potentials whenever voltage surpasses threshold.
Action potentials initiate reset rules that update voltage, threshold, and
(optionally) trigger afterspike currents.</p>
<p>The GLIF simulator in this package has a modular architecture
that enables users to choose from a number of dynamics and reset rules that
update the simulation&#8217;s voltage, spike threshold, and afterspike currents
during the simulation. The GLIF package contains a built-in set of rules,
however developers can plug in custom rule implementations provided they
follow a simple argument specification scheme.</p>
<p>The Allen SDK GLIF simulator was developed and tested with Python 2.7.9, installed
as part of <a class="reference external" href="https://store.continuum.io/cshop/anaconda/">Anaconda Python</a> distribution
version <a class="reference external" href="http://repo.continuum.io/archive/index.html">2.1.0</a>.</p>
<p>The rest of this page provides examples demonstrating how to download models,
examples of simulating these models, and general GLIF model documentation.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">the GLIF simulator module is still under heavy development and
may change significantly in the future.</p>
</div>
<div class="section" id="downloading-glif-models">
<h2>Downloading  GLIF Models<a class="headerlink" href="#downloading-glif-models" title="Permalink to this headline">¶</a></h2>
<p>There are two ways to download files necessary to run a GLIF model.  The
first way is to visit <a class="reference external" href="http://celltypes.brain-map.org">http://celltypes.brain-map.org</a> and find cells that have
GLIF models available for download.  The electrophysiology details page
for a cell has a neuronal model download link.  Specifically:</p>
<blockquote>
<div><ol class="arabic simple">
<li>Click &#8216;More Options +&#8217; and filter for GLIF models.</li>
<li>Click the electrophysiology thumbnail for a cell on the right hand panel.</li>
<li>Choose a GLIF model from the &#8216;Show model responses&#8217; dropdown.</li>
<li>Scroll down to the model response click &#8216;Download model&#8217;.</li>
</ol>
</div></blockquote>
<p>One such link (for a simple LIF neuronal model, ID 566302806), would look
like this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">api</span><span class="o">.</span><span class="n">brain</span><span class="o">-</span><span class="nb">map</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">neuronal_model</span><span class="o">/</span><span class="n">download</span><span class="o">/</span><span class="mi">566302806</span>
</pre></div>
</div>
<p>This link returns .zip archive containing the neuron configuration file
and sweep metadata required to simulate the model with stimuli applied to
the cell.  Specifically, the .zip archive will contain:</p>
<blockquote>
<div><ul class="simple">
<li><strong>472423251_neuron_config.json</strong>: JSON config file for the GLIF model</li>
<li><strong>ephys_sweeps.json</strong>: JSON with metadata for sweeps presented to the cell</li>
<li><strong>neuronal_model.json</strong>: JSON with general metadata for the cell</li>
</ul>
</div></blockquote>
<p>If you would like to reproduce the model traces seen in the Cell Types Database,
you can download an NWB file containing both the stimulus and cell response traces via a
&#8216;Download data&#8217; link on the cell&#8217;s electrophysiology page. See the
<a class="reference external" href="cell_types.html#neurodata-without-borders">NWB</a> description section
for more details on the NWB file format.</p>
<p>You can also download all of these files, including the cell&#8217;s NWB file,
using the <a class="reference internal" href="allensdk.api.queries.html#allensdk.api.queries.glif_api.GlifApi" title="allensdk.api.queries.glif_api.GlifApi"><code class="xref py py-class docutils literal"><span class="pre">GlifApi</span></code></a>
class:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">allensdk.api.queries.glif_api</span> <span class="k">import</span> <span class="n">GlifApi</span>
<span class="kn">import</span> <span class="nn">allensdk.core.json_utilities</span> <span class="k">as</span> <span class="nn">json_utilities</span>

<span class="n">neuronal_model_id</span> <span class="o">=</span> <span class="mi">566302806</span>

<span class="n">glif_api</span> <span class="o">=</span> <span class="n">GlifApi</span><span class="p">()</span>
<span class="n">glif_api</span><span class="o">.</span><span class="n">get_neuronal_model</span><span class="p">(</span><span class="n">neuronal_model_id</span><span class="p">)</span>
<span class="n">glif_api</span><span class="o">.</span><span class="n">cache_stimulus_file</span><span class="p">(</span><span class="s1">&#39;stimulus.nwb&#39;</span><span class="p">)</span>

<span class="n">neuron_config</span> <span class="o">=</span> <span class="n">glif_api</span><span class="o">.</span><span class="n">get_neuron_config</span><span class="p">()</span>
<span class="n">json_utilities</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;neuron_config.json&#39;</span><span class="p">,</span> <span class="n">neuron_config</span><span class="p">)</span>

<span class="n">ephys_sweeps</span> <span class="o">=</span> <span class="n">glif_api</span><span class="o">.</span><span class="n">get_ephys_sweeps</span><span class="p">()</span>
<span class="n">json_utilities</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;ephys_sweeps.json&#39;</span><span class="p">,</span> <span class="n">ephys_sweeps</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="running-a-glif-simulation">
<h2>Running a GLIF Simulation<a class="headerlink" href="#running-a-glif-simulation" title="Permalink to this headline">¶</a></h2>
<p>To run a GLIF simulation, the most important file you you need is the <code class="docutils literal"><span class="pre">neuron_config</span></code>
JSON file.  You can use this file to instantiate a simulator and feed in your own stimulus:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">allensdk.core.json_utilities</span> <span class="k">as</span> <span class="nn">json_utilities</span>
<span class="kn">from</span> <span class="nn">allensdk.model.glif.glif_neuron</span> <span class="k">import</span> <span class="n">GlifNeuron</span>

<span class="c1"># initialize the neuron</span>
<span class="n">neuron_config</span> <span class="o">=</span> <span class="n">json_utilities</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;neuron_config.json&#39;</span><span class="p">)</span>
<span class="n">neuron</span> <span class="o">=</span> <span class="n">GlifNeuron</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">neuron_config</span><span class="p">)</span>

<span class="c1"># make a short square pulse. stimulus units should be in Amps.</span>
<span class="n">stimulus</span> <span class="o">=</span> <span class="p">[</span> <span class="mf">0.0</span> <span class="p">]</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="p">[</span> <span class="mi">10</span><span class="n">e</span><span class="o">-</span><span class="mi">9</span> <span class="p">]</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="p">[</span> <span class="mf">0.0</span> <span class="p">]</span> <span class="o">*</span> <span class="mi">100</span>

<span class="c1"># important! set the neuron&#39;s dt value for your stimulus in seconds</span>
<span class="n">neuron</span><span class="o">.</span><span class="n">dt</span> <span class="o">=</span> <span class="mi">5</span><span class="n">e</span><span class="o">-</span><span class="mi">6</span>

<span class="c1"># simulate the neuron</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">neuron</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">stimulus</span><span class="p">)</span>

<span class="n">voltage</span> <span class="o">=</span> <span class="n">output</span><span class="p">[</span><span class="s1">&#39;voltage&#39;</span><span class="p">]</span>
<span class="n">threshold</span> <span class="o">=</span> <span class="n">output</span><span class="p">[</span><span class="s1">&#39;threshold&#39;</span><span class="p">]</span>
<span class="n">spike_times</span> <span class="o">=</span> <span class="n">output</span><span class="p">[</span><span class="s1">&#39;interpolated_spike_times&#39;</span><span class="p">]</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The GLIF simulator does not simulate during action potentials.
Instead it inserts <code class="docutils literal"><span class="pre">NaN</span></code> values for a fixed number of time steps when voltage
surpasses threshold.  The simulator skips <code class="docutils literal"><span class="pre">neuron.spike_cut_length</span></code> time steps
after voltage surpasses threshold.</p>
</div>
<p>To reproduce the model&#8217;s traces displayed on the Allen Cell Types Database web page,
the Allen SDK provides the <code class="xref py py-mod docutils literal"><span class="pre">allensdk.core.model.glif.simulate_neuron</span></code>
module for simulating all sweeps presented to a cell and storing them in the NWB format:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">allensdk.core.json_utilities</span> <span class="k">as</span> <span class="nn">json_utilities</span>

<span class="kn">from</span> <span class="nn">allensdk.model.glif.glif_neuron</span> <span class="k">import</span> <span class="n">GlifNeuron</span>
<span class="kn">from</span> <span class="nn">allensdk.model.glif.simulate_neuron</span> <span class="k">import</span> <span class="n">simulate_neuron</span>

<span class="n">neuron_config</span> <span class="o">=</span> <span class="n">json_utilities</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;neuron_config.json&#39;</span><span class="p">)</span>
<span class="n">ephys_sweeps</span> <span class="o">=</span> <span class="n">json_utilities</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;ephys_sweeps.json&#39;</span><span class="p">)</span>
<span class="n">ephys_file_name</span> <span class="o">=</span> <span class="s1">&#39;stimulus.nwb&#39;</span>

<span class="n">neuron</span> <span class="o">=</span> <span class="n">GlifNeuron</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">neuron_config</span><span class="p">)</span>

<span class="n">sweep_numbers</span> <span class="o">=</span> <span class="p">[</span> <span class="n">s</span><span class="p">[</span><span class="s1">&#39;sweep_number&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">ephys_sweeps</span> 
                  <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="s1">&#39;stimulus_units&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Amps&#39;</span> <span class="p">]</span>
<span class="n">simulate_neuron</span><span class="p">(</span><span class="n">neuron</span><span class="p">,</span> <span class="n">sweep_numbers</span><span class="p">,</span> <span class="n">ephys_file_name</span><span class="p">,</span> <span class="n">ephys_file_name</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">These stimuli are sampled at a very high resolution (200kHz),
and a given cell can have many sweeps.  This process can take over an hour.</p>
</div>
<p>The <code class="docutils literal"><span class="pre">simulate_neuron</span></code> function call simulates all sweeps in the NWB file.
Because the same NWB file is being used for both input and output,
the cell&#8217;s response traces will be overwritten as stimuli are simulated.
<code class="docutils literal"><span class="pre">simulate_neuron</span></code> optionally accepts a value which will be used to overwrite
these <code class="docutils literal"><span class="pre">NaN</span></code> values generated during action potentials (in this case 0.05 Volts).</p>
<p>If you would like to run a single sweep instead of all sweeps, try the following:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">allensdk.core.json_utilities</span> <span class="k">as</span> <span class="nn">json_utilities</span>
<span class="kn">from</span> <span class="nn">allensdk.model.glif.glif_neuron</span> <span class="k">import</span> <span class="n">GlifNeuron</span>
<span class="kn">from</span> <span class="nn">allensdk.core.nwb_data_set</span> <span class="k">import</span> <span class="n">NwbDataSet</span>

<span class="n">neuron_config</span> <span class="o">=</span> <span class="n">json_utilities</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;neuron_config.json&#39;</span><span class="p">)</span>
<span class="n">ephys_sweeps</span> <span class="o">=</span> <span class="n">json_utilities</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;ephys_sweeps.json&#39;</span><span class="p">)</span>
<span class="n">ephys_file_name</span> <span class="o">=</span> <span class="s1">&#39;stimulus.nwb&#39;</span>

<span class="c1"># pull out the stimulus for the first sweep</span>
<span class="n">ephys_sweep</span> <span class="o">=</span> <span class="n">ephys_sweeps</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">ds</span> <span class="o">=</span> <span class="n">NwbDataSet</span><span class="p">(</span><span class="n">ephys_file_name</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">get_sweep</span><span class="p">(</span><span class="n">ephys_sweep</span><span class="p">[</span><span class="s1">&#39;sweep_number&#39;</span><span class="p">])</span> 
<span class="n">stimulus</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;stimulus&#39;</span><span class="p">]</span>

<span class="c1"># initialize the neuron</span>
<span class="c1"># important! update the neuron&#39;s dt for your stimulus</span>
<span class="n">neuron</span> <span class="o">=</span> <span class="n">GlifNeuron</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">neuron_config</span><span class="p">)</span>
<span class="n">neuron</span><span class="o">.</span><span class="n">dt</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;sampling_rate&#39;</span><span class="p">]</span>

<span class="c1"># simulate the neuron</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">neuron</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">stimulus</span><span class="p">)</span>

<span class="n">voltage</span> <span class="o">=</span> <span class="n">output</span><span class="p">[</span><span class="s1">&#39;voltage&#39;</span><span class="p">]</span>
<span class="n">threshold</span> <span class="o">=</span> <span class="n">output</span><span class="p">[</span><span class="s1">&#39;threshold&#39;</span><span class="p">]</span>
<span class="n">spike_times</span> <span class="o">=</span> <span class="n">output</span><span class="p">[</span><span class="s1">&#39;interpolated_spike_times&#39;</span><span class="p">]</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <code class="docutils literal"><span class="pre">dt</span></code> value provided in the downloadable GLIF neuron configuration
files does not correspond to the sampling rate of the original stimulus.  Stimuli were
subsampled and filtered for parameter optimization.  Be sure to overwrite the neuron&#8217;s
<code class="docutils literal"><span class="pre">dt</span></code> with the correct sampling rate.</p>
</div>
<p>If you would like to plot the outputs of this simulation using numpy and matplotlib, try:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">voltage</span> <span class="o">=</span> <span class="n">output</span><span class="p">[</span><span class="s1">&#39;voltage&#39;</span><span class="p">]</span>
<span class="n">threshold</span> <span class="o">=</span> <span class="n">output</span><span class="p">[</span><span class="s1">&#39;threshold&#39;</span><span class="p">]</span>
<span class="n">interpolated_spike_times</span> <span class="o">=</span> <span class="n">output</span><span class="p">[</span><span class="s1">&#39;interpolated_spike_times&#39;</span><span class="p">]</span>
<span class="n">spike_times</span> <span class="o">=</span> <span class="n">output</span><span class="p">[</span><span class="s1">&#39;interpolated_spike_times&#39;</span><span class="p">]</span>
<span class="n">interpolated_spike_voltages</span> <span class="o">=</span> <span class="n">output</span><span class="p">[</span><span class="s1">&#39;interpolated_spike_voltage&#39;</span><span class="p">]</span>
<span class="n">interpolated_spike_thresholds</span> <span class="o">=</span> <span class="n">output</span><span class="p">[</span><span class="s1">&#39;interpolated_spike_threshold&#39;</span><span class="p">]</span>
<span class="n">grid_spike_indices</span> <span class="o">=</span> <span class="n">output</span><span class="p">[</span><span class="s1">&#39;spike_time_steps&#39;</span><span class="p">]</span>
<span class="n">grid_spike_times</span> <span class="o">=</span> <span class="n">output</span><span class="p">[</span><span class="s1">&#39;grid_spike_times&#39;</span><span class="p">]</span>
<span class="n">after_spike_currents</span> <span class="o">=</span> <span class="n">output</span><span class="p">[</span><span class="s1">&#39;AScurrents&#39;</span><span class="p">]</span>

<span class="c1"># create a time array for plotting</span>
<span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">stimulus</span><span class="p">))</span><span class="o">*</span><span class="n">neuron</span><span class="o">.</span><span class="n">dt</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

<span class="c1"># plot stimulus</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">stimulus</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;time (s)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;current (A)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Stimulus&#39;</span><span class="p">)</span>

<span class="c1"># plot model output</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">,</span>  <span class="n">voltage</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;voltage&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">,</span>  <span class="n">threshold</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;threshold&#39;</span><span class="p">)</span>

<span class="k">if</span> <span class="n">grid_spike_indices</span><span class="p">:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">interpolated_spike_times</span><span class="p">,</span> <span class="n">interpolated_spike_voltages</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> 
             <span class="n">label</span><span class="o">=</span><span class="s1">&#39;interpolated spike&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">((</span><span class="n">grid_spike_indices</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">neuron</span><span class="o">.</span><span class="n">dt</span><span class="p">,</span> <span class="n">voltage</span><span class="p">[</span><span class="n">grid_spike_indices</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> 
             <span class="n">label</span><span class="o">=</span><span class="s1">&#39;last step before spike&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;time (s)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;voltage (V)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Model Response&#39;</span><span class="p">)</span>

<span class="c1"># plot after spike currents</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">after_spike_currents</span><span class="p">)[</span><span class="mi">1</span><span class="p">]):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">after_spike_currents</span><span class="p">[:,</span><span class="n">ii</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;time (s)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;current (A)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;After Spike Currents&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">There both interpolated spike times and grid spike times.  The grid spike is the first time step
where the voltage is higher than the threshold.  Note that if you try to plot the voltage at the grid
spike indices the output will be <code class="docutils literal"><span class="pre">NaN</span></code>. The interpolated spike is the calculated intersection of the
threshold and voltage between the time steps.</p>
</div>
</div>
<div class="section" id="glif-configuration">
<h2>GLIF Configuration<a class="headerlink" href="#glif-configuration" title="Permalink to this headline">¶</a></h2>
<p>Instances of the <a class="reference internal" href="allensdk.model.glif.html#allensdk.model.glif.glif_neuron.GlifNeuron" title="allensdk.model.glif.glif_neuron.GlifNeuron"><code class="xref py py-class docutils literal"><span class="pre">GlifNeuron</span></code></a>
class require many parameters for initialization.
Fixed neuron parameters are stored directly as properties on the class instance:</p>
<table border="1" class="docutils">
<colgroup>
<col width="23%" />
<col width="52%" />
<col width="14%" />
<col width="11%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Parameter</th>
<th class="head">Description</th>
<th class="head">Units</th>
<th class="head">Type</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>El</td>
<td>resting potential</td>
<td>Volts</td>
<td>float</td>
</tr>
<tr class="row-odd"><td>dt</td>
<td>time duration of each simulation step</td>
<td>seconds</td>
<td>float</td>
</tr>
<tr class="row-even"><td>R_input</td>
<td>input resistance</td>
<td>Ohms</td>
<td>float</td>
</tr>
<tr class="row-odd"><td>C</td>
<td>capacitance</td>
<td>Farads</td>
<td>float</td>
</tr>
<tr class="row-even"><td>asc_vector</td>
<td>afterspike current coefficients</td>
<td>Amps</td>
<td>np.array</td>
</tr>
<tr class="row-odd"><td>spike_cut_length</td>
<td>spike duration</td>
<td>time steps</td>
<td>int</td>
</tr>
<tr class="row-even"><td>th_inf</td>
<td>instantaneous threshold</td>
<td>Volts</td>
<td>float</td>
</tr>
<tr class="row-odd"><td>th_adapt</td>
<td>adapted threshold</td>
<td>Volts</td>
<td>float</td>
</tr>
</tbody>
</table>
<p>Some of these fixed parameters were optimized to fit Allen Cell Types Database
electrophysiology data.  Optimized coefficients for these
parameters are stored by name in the <code class="docutils literal"><span class="pre">neuron.coeffs</span></code> dictionary. For more details
on which parameters were optimized, please see the technical
<a class="reference external" href="http://help.brain-map.org/display/celltypes/Documentation">white paper</a>.</p>
<p>The <a class="reference internal" href="allensdk.model.glif.html#allensdk.model.glif.glif_neuron.GlifNeuron" title="allensdk.model.glif.glif_neuron.GlifNeuron"><code class="xref py py-class docutils literal"><span class="pre">GlifNeuron</span></code></a> class has six
methods that can be customized: three rules
for updating voltage, threshold, and afterspike currents during the
simulation; and three rules for updating those values when a spike is detected
(voltage surpasses threshold).</p>
<table border="1" class="docutils">
<colgroup>
<col width="29%" />
<col width="71%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Method Type</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>voltage_dynamics_method</td>
<td>Update simulation voltage for the next time step.</td>
</tr>
<tr class="row-odd"><td>threshold_dynamics_method</td>
<td>Update simulation threshold for the next time step.</td>
</tr>
<tr class="row-even"><td>AScurrent_dynamics_method</td>
<td>Update afterspike current coefficients for the next time step.</td>
</tr>
<tr class="row-odd"><td>voltage_reset_method</td>
<td>Reset simulation voltage after a spike occurs.</td>
</tr>
<tr class="row-even"><td>threshold_reset_method</td>
<td>Reset simulation threshold after a spike occurs.</td>
</tr>
<tr class="row-odd"><td>AScurrent_reset_method</td>
<td>Reset afterspike current coefficients after a spike occurs.</td>
</tr>
</tbody>
</table>
<p>The GLIF neuron configuration files available from the Allen Brain Atlas API use built-in
methods, however you can supply your own custom method if you like:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># define your own custom voltage reset rule </span>
<span class="c1"># this one linearly scales the input voltage</span>
<span class="k">def</span> <span class="nf">custom_voltage_reset_rule</span><span class="p">(</span><span class="n">neuron</span><span class="p">,</span> <span class="n">voltage_t0</span><span class="p">,</span> <span class="n">custom_param_a</span><span class="p">,</span> <span class="n">custom_param_b</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">custom_param_a</span> <span class="o">*</span> <span class="n">voltage_t0</span> <span class="o">+</span> <span class="n">custom_param_b</span>

<span class="c1"># initialize a neuron from a neuron config file</span>
<span class="n">neuron_config</span> <span class="o">=</span> <span class="n">json_utilities</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;neuron_config.json&#39;</span><span class="p">)</span>
<span class="n">neuron</span> <span class="o">=</span> <span class="n">GlifNeuron</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">neuron_config</span><span class="p">)</span>

<span class="c1"># configure a new method and overwrite the neuron&#39;s old method</span>
<span class="n">method</span> <span class="o">=</span> <span class="n">neuron</span><span class="o">.</span><span class="n">configure_method</span><span class="p">(</span><span class="s1">&#39;custom&#39;</span><span class="p">,</span> <span class="n">custom_voltage_reset_rule</span><span class="p">,</span> 
                                 <span class="p">{</span> <span class="s1">&#39;custom_param_a&#39;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s1">&#39;custom_param_b&#39;</span><span class="p">:</span> <span class="mf">0.0</span> <span class="p">})</span>
<span class="n">neuron</span><span class="o">.</span><span class="n">voltage_reset_method</span> <span class="o">=</span> <span class="n">method</span>

<span class="n">output</span> <span class="o">=</span> <span class="n">neuron</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">stimulus</span><span class="p">)</span>
</pre></div>
</div>
<p>Notice that the function is allowed to take custom parameters (here <code class="docutils literal"><span class="pre">custom_param_a</span></code> and
<code class="docutils literal"><span class="pre">custom_param_b</span></code>), which are configured on method initialization from a dictionary. For more details,
see the documentation for the <a class="reference internal" href="allensdk.model.glif.html#allensdk.model.glif.glif_neuron.GlifNeuron" title="allensdk.model.glif.glif_neuron.GlifNeuron"><code class="xref py py-class docutils literal"><span class="pre">GlifNeuron</span></code></a> and
<a class="reference internal" href="allensdk.model.glif.html#allensdk.model.glif.glif_neuron_methods.GlifNeuronMethod" title="allensdk.model.glif.glif_neuron_methods.GlifNeuronMethod"><code class="xref py py-class docutils literal"><span class="pre">GlifNeuronMethod</span></code></a> classes.</p>
</div>
<div class="section" id="built-in-dynamics-rules">
<h2>Built-in Dynamics Rules<a class="headerlink" href="#built-in-dynamics-rules" title="Permalink to this headline">¶</a></h2>
<p>The job of a dynamics rule is to describe how the simulator should update
the voltage, spike threshold, and afterspike currents of the simulator at
a given simulation time step.</p>
<p><strong>Voltage Dynamics Rules</strong></p>
<p>These methods update the output voltage of the simulation.  They all expect a voltage,
afterspike current vector, and current injection value to be passed in by the GlifNeuron. All
other function parameters must be fixed using the GlifNeuronMethod class.  They all return an
updated voltage value.</p>
<blockquote>
<div><a class="reference internal" href="allensdk.model.glif.html#allensdk.model.glif.glif_neuron_methods.dynamics_voltage_linear_forward_euler" title="allensdk.model.glif.glif_neuron_methods.dynamics_voltage_linear_forward_euler"><code class="xref py py-meth docutils literal"><span class="pre">allensdk.model.glif.glif_neuron_methods.dynamics_voltage_linear_forward_euler()</span></code></a></div></blockquote>
<p><strong>Threshold Dynamics Rules</strong></p>
<p>These methods update the spike threshold of the simulation.  They all expect the current
threshold and voltage values of the simulation to be passed in by the GlifNeuron. All
other function parameters must be fixed using the GlifNeuronMethod class.  They all return an
updated threshold value.</p>
<blockquote>
<div><p><a class="reference internal" href="allensdk.model.glif.html#allensdk.model.glif.glif_neuron_methods.dynamics_threshold_three_components_exact" title="allensdk.model.glif.glif_neuron_methods.dynamics_threshold_three_components_exact"><code class="xref py py-meth docutils literal"><span class="pre">allensdk.model.glif.glif_neuron_methods.dynamics_threshold_three_components_exact()</span></code></a></p>
<p><a class="reference internal" href="allensdk.model.glif.html#allensdk.model.glif.glif_neuron_methods.dynamics_threshold_spike_component" title="allensdk.model.glif.glif_neuron_methods.dynamics_threshold_spike_component"><code class="xref py py-meth docutils literal"><span class="pre">allensdk.model.glif.glif_neuron_methods.dynamics_threshold_spike_component()</span></code></a></p>
<p><a class="reference internal" href="allensdk.model.glif.html#allensdk.model.glif.glif_neuron_methods.dynamics_threshold_inf" title="allensdk.model.glif.glif_neuron_methods.dynamics_threshold_inf"><code class="xref py py-meth docutils literal"><span class="pre">allensdk.model.glif.glif_neuron_methods.dynamics_threshold_inf()</span></code></a></p>
</div></blockquote>
<p><strong>Afterspike Current Dynamics Rules</strong></p>
<p>These methods expect current afterspike current coefficients, current time step,
and time steps of all previous spikes to be passed in by the GlifNeuron. All other function
parameters must be fixed using the GlifNeuronMethod class.  They all return an updated
afterspike current array.</p>
<blockquote>
<div><p><a class="reference internal" href="allensdk.model.glif.html#allensdk.model.glif.glif_neuron_methods.dynamics_AScurrent_exp" title="allensdk.model.glif.glif_neuron_methods.dynamics_AScurrent_exp"><code class="xref py py-meth docutils literal"><span class="pre">allensdk.model.glif.glif_neuron_methods.dynamics_AScurrent_exp()</span></code></a></p>
<p><a class="reference internal" href="allensdk.model.glif.html#allensdk.model.glif.glif_neuron_methods.dynamics_AScurrent_none" title="allensdk.model.glif.glif_neuron_methods.dynamics_AScurrent_none"><code class="xref py py-meth docutils literal"><span class="pre">allensdk.model.glif.glif_neuron_methods.dynamics_AScurrent_none()</span></code></a></p>
</div></blockquote>
</div>
<div class="section" id="built-in-reset-rules">
<h2>Built-in Reset Rules<a class="headerlink" href="#built-in-reset-rules" title="Permalink to this headline">¶</a></h2>
<p>The job of a reset rule is to describe how the simulator should update
the voltage, spike threshold, and afterspike currents of the simulator
after the simulator has detected that the simulated voltage has surpassed
threshold.</p>
<p><strong>Voltage Reset Rules</strong></p>
<p>These methods update the output voltage of the simulation after voltage has surpassed threshold.
They all expect a voltageto be passed in by the GlifNeuron. All other function parameters must be
fixed using the GlifNeuronMethod class.  They all return an updated voltage value.</p>
<blockquote>
<div><p><a class="reference internal" href="allensdk.model.glif.html#allensdk.model.glif.glif_neuron_methods.reset_voltage_zero" title="allensdk.model.glif.glif_neuron_methods.reset_voltage_zero"><code class="xref py py-meth docutils literal"><span class="pre">allensdk.model.glif.glif_neuron_methods.reset_voltage_zero()</span></code></a></p>
<p><a class="reference internal" href="allensdk.model.glif.html#allensdk.model.glif.glif_neuron_methods.reset_voltage_v_before" title="allensdk.model.glif.glif_neuron_methods.reset_voltage_v_before"><code class="xref py py-meth docutils literal"><span class="pre">allensdk.model.glif.glif_neuron_methods.reset_voltage_v_before()</span></code></a></p>
</div></blockquote>
<p><strong>Threshold Reset Rules</strong></p>
<p>These methods update the spike threshold of the simulation after a spike has been detected.
They all expect the current threshold and the reset voltage value of the simulation to be passed in by the GlifNeuron. All other function parameters must be fixed using the GlifNeuronMethod
class.  They all return an updated threshold value.</p>
<blockquote>
<div><p><a class="reference internal" href="allensdk.model.glif.html#allensdk.model.glif.glif_neuron_methods.reset_threshold_inf" title="allensdk.model.glif.glif_neuron_methods.reset_threshold_inf"><code class="xref py py-meth docutils literal"><span class="pre">allensdk.model.glif.glif_neuron_methods.reset_threshold_inf()</span></code></a></p>
<p><a class="reference internal" href="allensdk.model.glif.html#allensdk.model.glif.glif_neuron_methods.reset_threshold_three_components" title="allensdk.model.glif.glif_neuron_methods.reset_threshold_three_components"><code class="xref py py-meth docutils literal"><span class="pre">allensdk.model.glif.glif_neuron_methods.reset_threshold_three_components()</span></code></a></p>
</div></blockquote>
<p><strong>Afterspike Reset Reset Rules</strong></p>
<p>These methods expect current afterspike current coefficients to be passed in by
the GlifNeuron. All other function parameters must be fixed using the GlifNeuronMethod
class.  They all return an updated afterspike current array.</p>
<blockquote>
<div><p><a class="reference internal" href="allensdk.model.glif.html#allensdk.model.glif.glif_neuron_methods.reset_AScurrent_none" title="allensdk.model.glif.glif_neuron_methods.reset_AScurrent_none"><code class="xref py py-meth docutils literal"><span class="pre">allensdk.model.glif.glif_neuron_methods.reset_AScurrent_none()</span></code></a></p>
<p><a class="reference internal" href="allensdk.model.glif.html#allensdk.model.glif.glif_neuron_methods.reset_AScurrent_sum" title="allensdk.model.glif.glif_neuron_methods.reset_AScurrent_sum"><code class="xref py py-meth docutils literal"><span class="pre">allensdk.model.glif.glif_neuron_methods.reset_AScurrent_sum()</span></code></a></p>
</div></blockquote>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h3><a href="index.html">Contents</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="install.html">Install Guide</a><ul class="simple">
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="data_resources.html">Data Resources</a><ul>
<li class="toctree-l2"><a class="reference internal" href="brain_observatory.html">Brain Observatory</a></li>
<li class="toctree-l2"><a class="reference internal" href="cell_types.html">Cell Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="connectivity.html">Mouse Connectivity</a></li>
<li class="toctree-l2"><a class="reference internal" href="reference_space.html">Reference Space</a></li>
<li class="toctree-l2"><a class="reference internal" href="data_api_client.html">API Access</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="models.html">Models</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Generalized LIF</a></li>
<li class="toctree-l2"><a class="reference internal" href="biophysical_models.html">Biophysical</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="authors.html">Authors</a></li>
<li class="toctree-l1"><a class="reference internal" href="allensdk.html">Source Documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="allensdk.api.html">allensdk.api package</a></li>
<li class="toctree-l2"><a class="reference internal" href="allensdk.brain_observatory.html">allensdk.brain_observatory package</a></li>
<li class="toctree-l2"><a class="reference internal" href="allensdk.config.html">allensdk.config package</a></li>
<li class="toctree-l2"><a class="reference internal" href="allensdk.core.html">allensdk.core package</a></li>
<li class="toctree-l2"><a class="reference internal" href="allensdk.ephys.html">allensdk.ephys package</a></li>
<li class="toctree-l2"><a class="reference internal" href="allensdk.model.html">allensdk.model package</a></li>
<li class="toctree-l2"><a class="reference internal" href="allensdk.morphology.html">allensdk.morphology package</a></li>
<li class="toctree-l2"><a class="reference internal" href="allensdk.test_utilities.html">allensdk.test_utilities package</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/AllenInstitute/AllenSDK">Github Profile</a></li>
</ul>

<h3> Questions </h3>
<p class="questions">
  Send any questions using the <a href="http://alleninstitute.org/contact_us/index.html">Send Us a Message</a> link below, 
  or submit your question to <a href="http://stackoverflow.com/">StackOverflow</a> using with the 'allensdk' tag.
</p>

<p class="questions">
  If you encounter any problems using the AllenSDK, please create an issue on <a href="http://github.com/alleninstitute/allensdk/issues/">Github's issue tracker</a>.
</p>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>


    <div class="footer" role="contentinfo">
    </div>
<script type="text/javascript" src="http://www.brain-map.org/external_assets/javascripts/portalFooter.js"></script>


  </body>
</html>